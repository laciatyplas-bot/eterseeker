<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MAPA ETERNIVERSE ‚Äî Centrum KsiƒÖg v2.0</title>
  <meta name="description" content="Centralny interfejs Architekta. Wszystkie Bram i ksiƒôgi w jednym, czytelnym widoku. Persystencja, sortowanie, eksport CSV.">

  <style>
    :root{
      --bg:#050814;
      --card:#0A1727;
      --card-soft:#0D1C30;
      --text:#E9F4FF;
      --muted:#9BA9C8;
      --border:#20324A;
      --gold:#D9A441;
      --teal:#28D3C6;
      --green:#12C65B;
      --orange:#FFB14B;
      --red:#FF6B6B;
      --gray:#8B8FA0;
      --purple:#9B6BFF;
      --pink:#FF9FF3;
      --blue:#5DADE2;
      --shadow:0 8px 32px rgba(0,0,0,0.4);
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      background: radial-gradient(circle at top, #15223A 0%, #050814 55%, #01030A 100%);
      color:var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height:100vh;
    }
    .wrap{
      max-width:1400px;
      margin:0 auto;
      padding:32px 20px 60px;
    }
    header{
      text-align:center;
      margin-bottom:36px;
    }
    h1{
      font-size:38px;
      letter-spacing:4px;
      text-transform:uppercase;
      color:var(--gold);
      margin-bottom:8px;
      text-shadow:0 4px 16px rgba(217,164,65,0.3);
    }
    .subtitle{
      color:var(--muted);
      font-size:15px;
      max-width:600px;
      margin:0 auto;
      line-height:1.5;
    }
    .stats{
      display:flex;
      justify-content:center;
      gap:24px;
      margin-top:20px;
      flex-wrap:wrap;
    }
    .stat{
      background:var(--card-soft);
      padding:12px 20px;
      border-radius:12px;
      border:1px solid var(--border);
      text-align:center;
    }
    .stat-value{font-size:20px;font-weight:700;color:var(--gold);}
    .stat-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-top:2px;}

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin:28px 0 24px;
      align-items:center;
      background:var(--card-soft);
      padding:16px 20px;
      border-radius:14px;
      border:1px solid var(--border);
    }
    .search{
      flex:1 1 280px;
      position:relative;
    }
    .search input{
      width:100%;
      padding:12px 16px 12px 40px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#050B16;
      color:var(--text);
      font-size:14px;
    }
    .search::before{
      content:"üîç";
      position:absolute;
      left:14px;top:50%;
      transform:translateY(-50%);
      color:var(--muted);
      font-size:14px;
    }
    .toolbar select,
    .toolbar button{
      border-radius:12px;
      border:1px solid var(--border);
      padding:12px 16px;
      font-size:14px;
      background:#050B16;
      color:var(--text);
      cursor:pointer;
      transition:all 0.2s;
    }
    .toolbar button.main{
      background:linear-gradient(135deg,var(--gold),#E9B949);
      color:#02030A;
      font-weight:700;
      border:none;
      box-shadow:0 4px 16px rgba(217,164,65,0.3);
    }
    .toolbar button.main:hover{background:linear-gradient(135deg,#E9B949,#D9A441);}
    .toolbar button.danger{background:var(--red);color:#fff;}
    .toolbar button.success{background:var(--green);color:#fff;}

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      gap:20px;
      margin-top:20px;
    }
    .brama-card{
      background:var(--card);
      border-radius:18px;
      border:1px solid var(--border);
      padding:20px;
      display:flex;
      flex-direction:column;
      min-height:280px;
      transition:transform 0.2s,box-shadow 0.2s;
      position:relative;
      overflow:hidden;
    }
    .brama-card:hover{
      transform:translateY(-4px);
      box-shadow:var(--shadow);
    }
    .brama-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:16px;
      padding-bottom:12px;
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .brama-title{
      font-size:16px;
      font-weight:700;
      color:var(--text);
    }
    .brama-sub{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.8px;
      color:var(--muted);
      margin-top:6px;
      line-height:1.4;
    }
    .badge{
      font-size:11px;
      padding:6px 12px;
      border-radius:20px;
      background:rgba(217,164,65,0.2);
      color:var(--gold);
      text-transform:uppercase;
      letter-spacing:0.8px;
      font-weight:600;
    }
    .books{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
      overflow-y:auto;
      max-height:400px;
      padding-right:4px;
    }
    .books::-webkit-scrollbar{width:4px;}
    .books::-webkit-scrollbar-track{background:transparent;}
    .books::-webkit-scrollbar-thumb{background:rgba(217,164,65,0.3);border-radius:2px;}

    .book{
      background:var(--card-soft);
      border-radius:12px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.06);
      display:flex;
      gap:12px;
      align-items:center;
      cursor:pointer;
      transition:all 0.2s;
      position:relative;
    }
    .book:hover{
      background:#0F2138;
      border-color:rgba(217,164,65,0.4);
      transform:translateX(4px);
    }
    .book-cover-thumb{
      width:36px;
      height:52px;
      border-radius:6px;
      flex-shrink:0;
      background:linear-gradient(135deg,#1A2338,#101624);
      background-size:cover;
      background-position:center;
      border:1px solid rgba(255,255,255,0.12);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      color:var(--gray);
      font-weight:600;
      position:relative;
    }
    .book-cover-thumb::after{
      content:attr(data-initials);
      font-size:9px;
      background:linear-gradient(135deg,var(--gold),#E9B949);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .book-main{
      flex:1;
      min-width:0;
    }
    .book-title{
      font-size:13px;
      font-weight:600;
      margin-bottom:4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .book-meta{
      font-size:11px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .status{
      font-size:10px;
      padding:4px 10px;
      border-radius:12px;
      text-transform:uppercase;
      letter-spacing:0.6px;
      font-weight:700;
    }
    .st-published{background:rgba(18,198,91,0.25);color:var(--green);}
    .st-ready{background:rgba(217,164,65,0.25);color:var(--gold);}
    .st-writing{background:rgba(40,211,198,0.25);color:var(--teal);}
    .st-draft{background:rgba(255,177,75,0.25);color:var(--orange);}
    .st-idea{background:rgba(139,143,160,0.3);color:var(--gray);}

    .no-books{
      font-size:12px;
      color:var(--muted);
      padding:20px 8px;
      text-align:center;
      font-style:italic;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,0.75);
      display:none;align-items:center;justify-content:center;z-index:2000;
      backdrop-filter:blur(4px);
    }
    .modal{
      background:var(--card);
      border-radius:20px;
      border:1px solid var(--border);
      padding:24px;
      max-width:480px;
      width:90%;
      box-shadow:var(--shadow);
      max-height:90vh;
      overflow-y:auto;
    }
    .modal h2{
      font-size:18px;
      margin-bottom:16px;
      color:var(--gold);
    }
    .modal-row{
      margin-bottom:16px;
    }
    .modal label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
      font-weight:500;
    }
    .modal input,
    .modal select,
    .modal textarea{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#050B16;
      color:var(--text);
      font-size:14px;
      resize:vertical;
    }
    .modal textarea{height:80px;}
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:12px;
      margin-top:20px;
      padding-top:16px;
      border-top:1px solid var(--border);
    }

    /* Cover preview */
    .cover-preview{
      position:fixed;inset:0;
      background:rgba(0,0,0,0.92);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2100;
      backdrop-filter:blur(8px);
    }
    .cover-preview img{
      max-width:95vw;
      max-height:95vh;
      border-radius:12px;
      box-shadow:0 32px 80px rgba(0,0,0,0.8);
    }
    .cover-preview-close{
      position:fixed;
      top:24px;right:24px;
      font-size:28px;
      cursor:pointer;
      color:#eee;
      width:48px;
      height:48px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(10px);
    }

    /* Export success */
    .toast{
      position:fixed;
      top:24px;right:24px;
      background:var(--green);
      color:#fff;
      padding:16px 24px;
      border-radius:12px;
      font-weight:600;
      transform:translateX(400px);
      transition:transform 0.3s;
      z-index:3000;
      box-shadow:var(--shadow);
    }
    .toast.show{transform:translateX(0);}

    @media (max-width:768px){
      .wrap{padding:20px 16px 40px;}
      .toolbar{flex-direction:column;align-items:stretch;}
      .toolbar button,.toolbar select{width:100%;}
      .stats{gap:16px;}
      .grid{grid-template-columns:1fr;gap:16px;}
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üåå MAPA ETERNIVERSE</h1>
    <div class="subtitle">
      Centralny interfejs Architekta Woli (Maciej Maciuszek). ZarzƒÖdzaj wszystkimi Bramami i ksiƒôgami.<br>
      <strong>Nowo≈õƒá:</strong> Persystencja localStorage ‚Ä¢ Sortowanie status√≥w ‚Ä¢ Eksport CSV ‚Ä¢ Statystyki.
    </div>
    <div class="stats" id="stats">
      <!-- Stats wype≈Çni JS -->
    </div>
  </header>

  <div class="toolbar">
    <div class="search">
      <input type="text" id="searchInput" placeholder="Szukaj tytu≈Çu, tagu, opisu, statusu...">
    </div>
    <select id="gateFilter">
      <option value="all">üåÄ Wszystkie bramy</option>
    </select>
    <select id="statusFilter">
      <option value="all">üìä Wszystkie statusy</option>
      <option value="published">‚úÖ Opublikowane</option>
      <option value="ready">üü° Gotowe</option>
      <option value="writing">‚úçÔ∏è Pisanie</option>
      <option value="draft">üìù Szkic</option>
      <option value="idea">üí° Idea</option>
    </select>
    <button class="main" id="addBookBtn">+ Nowa ksiƒôga</button>
    <button class="success" id="exportBtn">üì§ Eksport CSV</button>
    <button class="danger" id="resetBtn" title="Resetuj dane (ostro≈ºnie!)">üóëÔ∏è Reset</button>
  </div>

  <main>
    <section class="grid" id="gatesGrid"></section>
  </main>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="addModal">
  <div class="modal">
    <h2>üåü Nowa ksiƒôga</h2>
    <div class="modal-row">
      <label>üéØ Brama</label>
      <select id="modalGate"></select>
    </div>
    <div class="modal-row">
      <label>üìñ Tytu≈Ç</label>
      <input id="modalTitle" placeholder="np. InterSeeker ‚Äì Atlas Wewnƒôtrzny">
    </div>
    <div class="modal-row">
      <label>üìù Opis (opcjonalnie)</label>
      <textarea id="modalDesc" placeholder="Kr√≥tki opis / tagi / notatki..."></textarea>
    </div>
    <div class="modal-row">
      <label>üìä Status</label>
      <select id="modalStatus">
        <option value="idea">üí° Idea</option>
        <option value="draft">üìù Szkic</option>
        <option value="writing">‚úçÔ∏è W trakcie pisania</option>
        <option value="ready">üü° Gotowe</option>
        <option value="published">‚úÖ Opublikowane</option>
      </select>
    </div>
    <div class="modal-row">
      <label>üñºÔ∏è URL ok≈Çadki</label>
      <input id="modalCover" placeholder="https://wattpad.com/cover.jpg lub Canva...">
    </div>
    <div class="modal-actions">
      <button id="modalCancel">Anuluj</button>
      <button class="main" id="modalSave">üíæ Zapisz ksiƒôgƒô</button>
    </div>
  </div>
</div>

<!-- Cover preview -->
<div class="cover-preview" id="coverPreview">
  <div class="cover-preview-close" id="coverClose">√ó</div>
  <img id="coverImg" src="" alt="Ok≈Çadka ksiƒôgi">
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
  // ===== ULEPSZONE DANE z kolorami i opisami =====
  const DEFAULT_DATA = [
    {
      id:1,name:"BRAMA I ‚Äî INTERSEEKER",sub:"Psychika ¬∑ Cie≈Ñ ¬∑ Trauma ¬∑ Archetyp",tag:"CORE/PSYCHE",color:"var(--teal)",
      books:[{title:"InterSeeker ‚Äì Atlas Wewnƒôtrzny",status:"published",cover:"",desc:"Interfejs ≈õwiadomo≈õci #1 Wattpad"},
             {title:"ShadowSeeker ‚Äì Anatomia Cienia",status:"ready",cover:"",desc:"Efekt Cienia ‚Äì trauma processing"},
             {title:"MemorySeeker ‚Äì Archeologia Wspomnie≈Ñ",status:"draft",cover:"",desc:""}]
    },
    {
      id:2,name:"BRAMA II ‚Äî CUSTOS/GENEZA",sub:"Stra≈ºnik ¬∑ Rdze≈Ñ ¬∑ PoczƒÖtek",tag:"CORE/ORIGIN",color:"var(--red)",
      books:[{title:"Geneza",status:"ready",cover:"",desc:"PoczƒÖtek ETERUNIVERSE"},
             {title:"Custos: Kodeks G≈Çƒôbi",status:"idea",cover:"",desc:"Stra≈ºnik rdzenia"}]
    },
    {
      id:3,name:"BRAMA III ‚Äî ETERSEEKER",sub:"Wola ¬∑ Pole ¬∑ Architektura",tag:"CORE/FIELD",color:"var(--gold)",
      books:[{title:"EterSeeker ‚Äì Ksiƒôga Zakazana (Tom Zero)",status:"writing",cover:"",desc:""},
             {title:"EterSeeker ‚Äì Architektura Woli",status:"idea",cover:"",desc:"Kronika Woli"}]
    },
    {
      id:4,name:"BRAMA IV ‚Äî ARCHETYPY/WOLA",sub:"Konstrukcja ¬∑ Role ¬∑ Przeznaczenie",tag:"CORE/WILL",color:"var(--purple)",
      books:[{title:"ArchetypSeeker ‚Äì System Archetyp√≥w",status:"idea",cover:"",desc:""},
             {title:"Kronika Woli (meta)",status:"published",cover:"",desc:"#2 Wattpad Metafizyka"}]
    },
    {
      id:5,name:"BRAMA V ‚Äî OBFITOSEEKER",sub:"Materia ¬∑ Przep≈Çyw ¬∑ Manifestacja",tag:"EMBODIED/FLOW",color:"var(--green)",
      books:[{title:"ObfitoSeeker ‚Äì Kod Obfito≈õci",status:"writing",cover:"",desc:"Janowice ‚Äì gorƒÖcy projekt"},
             {title:"MateriaSeeker ‚Äì Przewodnik Cia≈Ça",status:"draft",cover:"",desc:""}]
    },
    {
      id:6,name:"BRAMA VI ‚Äî BIOSEEKER",sub:"Cia≈Ço ¬∑ Biologia ¬∑ Regulacja",tag:"EMBODIED/BIO",color:"var(--orange)",
      books:[{title:"BioSeeker ‚Äì Sekret Biologii Pola",status:"idea",cover:"",desc:""}]
    },
    {
      id:7,name:"BRAMA VII ‚Äî SPLƒÑTANIE/AI",sub:"Obserwator ¬∑ Meta-to≈ºsamo≈õƒá ¬∑ Technologia",tag:"META/TECH",color:"var(--blue)",
      books:[{title:"SplatanieSeeker ‚Äì Protok√≥≈Ç Obserwatora",status:"idea",cover:"",desc:"Kronika SplƒÖtania"},
             {title:"InterfejsSeeker ‚Äì Interfejs ≈öwiadomo≈õci",status:"published",cover:"",desc:"#1 Wattpad"}]
    },
    {
      id:8,name:"BRAMA VIII ‚Äî TRAJEKTORIE",sub:"Kod ≈ªycia ¬∑ Linie Czasu ¬∑ Fizyka Duszy",tag:"META/PHYSICS",color:"var(--pink)",
      books:[{title:"TrajektoriaSeeker ‚Äì Mapa Linii ≈ªycia",status:"ready",cover:"",desc:""},
             {title:"QuantumSeeker ‚Äì Fizyka Duszy",status:"idea",cover:"",desc:""}]
    },
    {
      id:9,name:"BRAMA IX ‚Äî ETERNIONY",sub:"Wƒôz≈Çy Pola ¬∑ Wsp√≥lnota ¬∑ Misja",tag:"COLLECTIVE",color:"var(--purple)",
      books:[{title:"Eterniony ‚Äì Tom I",status:"idea",cover:"",desc:""},
             {title:"Eterniony ‚Äì Tom II",status:"draft",cover:"",desc:""}]
    },
    {
      id:10,name:"BRAMA X ‚Äî ETERUNIVERSE",sub:"Integracja ¬∑ Jedno≈õƒá ¬∑ Architekt",tag:"INTEGRATION",color:"var(--gold)",
      books:[{title:"ETERUNIVERSE: System Bram",status:"published",cover:"",desc:"#4 Wattpad"},
             {title:"Mapa Uniwersum Eteru",status:"writing",cover:"",desc:""}]
    }
  ];

  // ===== GLOBALNE ZMIENNE =====
  let DATA = [];
  const STORAGE_KEY = 'eterniverse-data-v2';
  const elements = {
    gatesGrid: document.getElementById('gatesGrid'),
    gateFilter: document.getElementById('gateFilter'),
    statusFilter: document.getElementById('statusFilter'),
    searchInput: document.getElementById('searchInput'),
    stats: document.getElementById('stats'),
    addModal: document.getElementById('addModal'),
    modalGate: document.getElementById('modalGate'),
    modalTitle: document.getElementById('modalTitle'),
    modalDesc: document.getElementById('modalDesc'),
    modalStatus: document.getElementById('modalStatus'),
    modalCover: document.getElementById('modalCover'),
    coverPreview: document.getElementById('coverPreview'),
    coverImg: document.getElementById('coverImg'),
    toast: document.getElementById('toast'),
    addBookBtn: document.getElementById('addBookBtn'),
    exportBtn: document.getElementById('exportBtn'),
    resetBtn: document.getElementById('resetBtn'),
    modalSave: document.getElementById('modalSave'),
    modalCancel: document.getElementById('modalCancel'),
    coverClose: document.getElementById('coverClose')
  };

  // ===== INICJALIZACJA =====
  function init() {
    loadData();
    populateFilters();
    render();
    bindEvents();
    updateStats();
  }

  // ===== PERSYSTENCJA =====
  function loadData() {
    try {
      const saved = localStorage.getItem(STORAGE_KEY);
      DATA = saved ? JSON.parse(saved) : [...DEFAULT_DATA];
    } catch(e) {
      console.warn('B≈ÇƒÖd ≈Çadowania danych:', e);
      DATA = [...DEFAULT_DATA];
    }
  }

  function saveData() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));
    } catch(e) {
      console.warn('B≈ÇƒÖd zapisu:', e);
    }
  }

  // ===== Wype≈Çnij filtry =====
  function populateFilters() {
    elements.gateFilter.innerHTML = '<option value="all">üåÄ Wszystkie bramy</option>';
    elements.modalGate.innerHTML = '';
    DATA.forEach(b => {
      const opt1 = document.createElement('option');
      opt1.value = b.id;
      opt1.textContent = b.name;
      elements.gateFilter.appendChild(opt1);

      const opt2 = document.createElement('option');
      opt2.value = b.id;
      opt2.textContent = b.name;
      elements.modalGate.appendChild(opt2);
    });
  }

  // ===== RENDERING =====
  function render() {
    const q = elements.searchInput.value.toLowerCase().trim();
    const gate = elements.gateFilter.value;
    const st = elements.statusFilter.value;

    elements.gatesGrid.innerHTML = '';

    DATA.forEach(brama => {
      if(gate !== 'all' && String(brama.id) !== gate) return;

      const card = document.createElement('article');
      card.className = 'brama-card';
      card.style.borderLeft = `4px solid ${brama.color}`;

      const books = brama.books
        .filter(book => {
          if(st !== 'all' && book.status !== st) return false;
          const text = (book.title + ' ' + (book.desc || '')).toLowerCase();
          return !q || text.includes(q);
        })
        .sort((a,b) => {
          const order = {published:4,ready:3,writing:2,draft:1,idea:0};
          return order[b.status] - order[a.status];
        });

      card.innerHTML = `
        <div class="brama-header">
          <div>
            <div class="brama-title" style="color:${brama.color}">${brama.name}</div>
            <div class="brama-sub">${brama.sub}</div>
          </div>
          <span class="badge" style="background:rgba(217,164,65,0.15);color:${brama.color}">${brama.tag}</span>
        </div>
      `;

      const booksWrap = document.createElement('div');
      booksWrap.className = 'books';

      if(!books.length) {
        const info = document.createElement('div');
        info.className = 'no-books';
        info.innerHTML = 'üåå<br>Brak tytu≈Ç√≥w w tym filtrze';
        booksWrap.appendChild(info);
      } else {
        books.forEach(book => {
          const initials = book.title.split(' ').map(w => w[0]).slice(0,2).join('').toUpperCase();
          const el = document.createElement('div');
          el.className = 'book';
          el.innerHTML = `
            <div class="book-cover-thumb" data-initials="${initials}" style="${book.cover ? `background-image:url('${book.cover}');background-size:cover` : ''}">
            </div>
            <div class="book-main">
              <div class="book-title">${book.title}</div>
              <div class="book-meta">
                <span>${book.status?.replace(/^w/, c => c.toUpperCase()) || 'Idea'}</span>
                <span class="status st-${book.status || 'idea'}">${(book.status || 'idea').toUpperCase()}</span>
              </div>
              ${book.desc ? `<div style="font-size:10px;color:var(--muted);margin-top:4px;line-height:1.3;">${book.desc}</div>` : ''}
            </div>
          `;

          // Click handlers
          const thumb = el.querySelector('.book-cover-thumb');
          el.addEventListener('click', () => showBookDetails(book, brama));
          if(book.cover) {
            thumb.addEventListener('click', (e) => {
              e.stopPropagation();
              showCover(book.cover);
            });
          }

          booksWrap.appendChild(el);
        });
      }

      card.appendChild(booksWrap);
      elements.gatesGrid.appendChild(card);
    });

    updateStats();
  }

  // ===== STATYSTYKI =====
  function updateStats() {
    const totalGates = DATA.length;
    const totalBooks = DATA.reduce((sum, g) => sum + g.books.length, 0);
    const byStatus = DATA.reduce((acc, g) => {
      g.books.forEach(b => acc[b.status || 'idea'] = (acc[b.status || 'idea'] || 0) + 1);
      return acc;
    }, {});

    elements.stats.innerHTML = `
      <div class="stat">
        <div class="stat-value">${totalGates}</div>
        <div class="stat-label">Bram</div>
      </div>
      <div class="stat">
        <div class="stat-value">${totalBooks}</div>
        <div class="stat-label">KsiƒÖg</div>
      </div>
      <div class="stat">
        <div class="stat-value">${byStatus.published || 0}</div>
        <div class="stat-label">‚úÖ Published</div>
      </div>
      <div class="stat">
        <div class="stat-value">${byStatus.writing || 0}</div>
        <div class="stat-label">‚úçÔ∏è Writing</div>
      </div>
    `;
  }

  // ===== EVENTY =====
  function bindEvents() {
    // Filtry
    [elements.searchInput, elements.gateFilter, elements.statusFilter].forEach(el => {
      el.addEventListener('input', render);
      el.addEventListener('change', render);
    });

    // Modal
    elements.addBookBtn.onclick = () => openModal();
    elements.modalCancel.onclick = () => closeModal();
    elements.modalSave.onclick = () => saveBook();

    // Cover preview
    elements.coverClose.onclick = closeCover;
    elements.coverPreview.onclick = closeCover;

    // Export/Reset
    elements.exportBtn.onclick = exportCSV;
    elements.resetBtn.onclick = () => {
      if(confirm('üóëÔ∏è Resetuj wszystkie dane? (stracisz zmiany)') ) {
        localStorage.removeItem(STORAGE_KEY);
        DATA = [...DEFAULT_DATA];
        populateFilters();
        render();
        showToast('Dane zresetowane');
      }
    };
  }

  // ===== MODAL =====
  function openModal(editBook = null, gateId = null) {
    elements.modalTitle.value = editBook?.title || '';
    elements.modalDesc.value = editBook?.desc || '';
    elements.modalStatus.value = editBook?.status || 'idea';
    elements.modalCover.value = editBook?.cover || '';
    if(gateId) elements.modalGate.value = gateId;
    elements.addModal.style.display = 'flex';
    elements.modalTitle.focus();
  }

  function closeModal() {
    elements.addModal.style.display = 'none';
  }

  function saveBook() {
    const gateId = Number(elements.modalGate.value);
    const title = elements.modalTitle.value.trim();
    if(!title) return alert('Podaj tytu≈Ç!');

    const brama = DATA.find(b => b.id === gateId);
    if(!brama) return alert('Brama nie istnieje!');

    const newBook = {
      title,
      status: elements.modalStatus.value,
      desc: elements.modalDesc.value.trim(),
      cover: elements.modalCover.value.trim()
    };

    const existing = brama.books.find(b => b.title === title);
    if(existing) {
      Object.assign(existing, newBook);
    } else {
      brama.books.push(newBook);
    }

    saveData();
    render();
    closeModal();
    showToast(existing ? 'Zaktualizowano ksiƒôgƒô' : 'Dodano nowƒÖ ksiƒôgƒô');
  }

  // ===== COVER PREVIEW =====
  function showCover(url) {
    elements.coverImg.src = url;
    elements.coverPreview.style.display = 'flex';
  }

  function closeCover() {
    elements.coverPreview.style.display = 'none';
    elements.coverImg.src = '';
  }

  // ===== SZCZEG√ì≈ÅY KSIƒÑGI =====
  function showBookDetails(book, brama) {
    const details = `
      <strong>${book.title}</strong><br>
      <small>${brama.name} | ${book.status?.toUpperCase()}</small><br><br>
      ${book.desc ? book.desc + '<br><br>' : ''}
      ${book.cover ? `<img src="${book.cover}" style="max-width:100%;border-radius:8px;">` : 'Brak ok≈Çadki'}
    `;
    alert(details); // TODO: Piƒôkniejszy modal
  }

  // ===== EKSORT CSV =====
  function exportCSV() {
    let csv = 'Brama,Tytu≈Ç,Status,Opis,Ok≈Çadka
';
    DATA.forEach(brama => {
      brama.books.forEach(book => {
        csv += `"${brama.name}","${book.title}","${book.status}","${book.desc || ''}","${book.cover || ''}"
`;
      });
    });

    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `ETERNIVERSE_${new Date().toISOString().slice(0,10)}.csv`;
    link.click();
    showToast('üì§ Eksport CSV gotowy!');
  }

  // ===== TOAST =====
  function showToast(message) {
    elements.toast.textContent = message;
    elements.toast.classList.add('show');
    setTimeout(() => elements.toast.classList.remove('show'), 3000);
  }

  // ===== START =====
  init();
</script>
</body>
</html>