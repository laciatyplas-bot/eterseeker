<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MAPA ETERNIVERSE v13.0 ‚Äî 9 Bram Uniwersum</title>
  <meta name="description" content="Pe≈Çna, ≈ºywa mapa 9 Bram Eterniverse z ksiƒôgami i realtime sync."/>
  <meta name="theme-color" content="#D9A441"/>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
    :root {
      --teal: #28D3C6; --gold: #D9A441; --green: #12C65B; --purple: #9B6BFF; --orange: #FFB14B;
      --red: #FF6B6B; --pink: #FF9FF3; --blue: #5DADE2; --indigo: #667eea;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: #000 url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-4.0.3&auto=format&fit=crop&w=2112&q=80') center/cover fixed;
      color: white; font-family: 'Inter', system-ui, sans-serif; overflow: hidden; height: 100vh;
    }

    .controls { position: fixed; top: 20px; left: 20px; z-index: 1000; display: flex; gap: 12px; flex-wrap: wrap; }
    .btn { background: rgba(255,255,255,0.12); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.25); color: white; padding: 12px 20px; border-radius: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn:hover { background: rgba(255,255,255,0.22); transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }

    .cloud-status { position: fixed; top: 70px; right: 20px; background: rgba(40,211,198,0.2); color: var(--teal); padding: 10px 16px; border-radius: 12px; font-size: 13px; font-weight: 700; border: 1px solid var(--teal); z-index: 900; backdrop-filter: blur(8px); display: flex; align-items: center; gap: 8px; }

    #mapCanvas { width: 100vw; height: 100vh; cursor: grab; }
    #mapCanvas:active { cursor: grabbing; }

    .info-panel {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(8,18,28,0.97); backdrop-filter: blur(24px);
      border: 1px solid rgba(255,255,255,0.2); border-radius: 24px; padding: 36px; max-width: 700px; max-height: 85vh; overflow-y: auto;
      box-shadow: 0 30px 80px rgba(0,0,0,0.8); z-index: 2000; display: none;
    }
    .info-title { font-size: 32px; font-weight: 800; margin-bottom: 12px; text-align: center; background: linear-gradient(90deg, var(--gold), white); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .info-sub { font-size: 18px; color: rgba(255,255,255,0.7); margin-bottom: 32px; text-align: center; text-transform: uppercase; letter-spacing: 1px; }
    .books-list { list-style: none; }
    .book-item { padding: 16px; background: rgba(255,255,255,0.06); border-radius: 14px; margin-bottom: 14px; border-left: 4px solid var(--teal); }
    .book-title { font-weight: 700; font-size: 17px; margin-bottom: 8px; }
    .book-status { font-size: 13px; padding: 6px 12px; border-radius: 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
    .status-published { background: var(--green); color: #000; }
    .status-writing { background: var(--teal); color: #000; }
    .status-ready { background: var(--gold); color: #000; }
    .status-draft { background: var(--orange); color: #000; }
    .status-idea { background: #666; color: white; }
    .close-info { position: absolute; top: 20px; right: 24px; font-size: 32px; cursor: pointer; color: #aaa; transition: color 0.3s; }
    .close-info:hover { color: white; }
  </style>
</head>
<body>

<div class="cloud-status" id="cloudStatus">
  <div class="cloud-dot"></div>
  <span id="cloudText">≈Åadowanie uniwersum...</span>
</div>

<div class="controls">
  <button class="btn" id="forceSync">‚òÅ Synchronizuj</button>
  <button class="btn" id="newBook">üìñ Nowa ksiƒôga</button>
  <button class="btn" id="centerMap">üéØ Wy≈õrodkuj</button>
</div>

<div class="info-panel" id="infoPanel">
  <span class="close-info" id="closeInfo">√ó</span>
  <div class="info-title" id="infoTitle">BRAMA 1 ‚Äî INTERSEEKER</div>
  <div class="info-sub" id="infoSub">Psychika ¬∑ Trauma ¬∑ Cie≈Ñ ¬∑ Archetyp</div>
  <ul class="books-list" id="booksList"></ul>
</div>

<canvas id="mapCanvas"></canvas>

<script>
  // ===== FIREBASE CONFIG (ZMIE≈É NA SWOJE) =====
  const firebaseConfig = { /* Twoje dane z Firebase Console */ };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const universeRef = db.ref('eterniverse/universe');

  // ===== PE≈ÅNE DANE 9 BRAM ‚Äî na podstawie Twojego oryginalnego JSON =====
  const ORIGINAL_BRAMY = [
    { id: 1, name: "BRAMA 1 ‚Äî INTERSEEKER", sub: "Psychika ¬∑ Trauma ¬∑ Cie≈Ñ ¬∑ Archetyp", color: "#28D3C6" },
    { id: 2, name: "BRAMA 2 ‚Äî ETERSEEKER", sub: "Wola ¬∑ Pole ¬∑ Architektura rzeczywisto≈õci", color: "#D9A441" },
    { id: 3, name: "BRAMA 3 ‚Äî OBFITOSEEKER", sub: "Materia ¬∑ Transformacja ¬∑ Obfito≈õƒá", color: "#12C65B" },
    { id: 4, name: "BRAMA 4 ‚Äî THE KNOT", sub: "Technologia ¬∑ SplƒÖtanie ¬∑ Protok√≥≈Ç", color: "#9B6BFF" },
    { id: 5, name: "BRAMA 5 ‚Äî QUANTUM KNOT", sub: "Kwanta ¬∑ Entropia ¬∑ Nowe trajektorie", color: "#FFB14B" },
    { id: 6, name: "BRAMA 6 ‚Äî PUSTKASEEKER", sub: "Cisza ¬∑ Nico≈õƒá ¬∑ ≈πr√≥d≈Ço", color: "#FF6B6B", books: [] },
    { id: 7, name: "BRAMA 7 ‚Äî JEDNOSEEKER", sub: "Jedno≈õƒá ¬∑ Nie-dualno≈õƒá ¬∑ Absolut", color: "#FF9FF3", books: [] },
    { id: 8, name: "BRAMA 8 ‚Äî WIECZNOSEEKER", sub: "Czas ¬∑ Wieczno≈õƒá ¬∑ Poza liniƒÖ", color: "#5DADE2", books: [] },
    { id: 9, name: "BRAMA 9 ‚Äî ARCHITEKT", sub: "Tw√≥rca ¬∑ Manifest ¬∑ Wolna Wola", color: "#667eea", books: [] }
  ];

  // Przyk≈Çadowe ksiƒôgi z Twojego JSON (mo≈ºesz rozszerzyƒá)
  const SAMPLE_BOOKS = {
    1: [
      { title: "INTERSEEKER: Geneza", status: "ready" },
      { title: "InterSeeker ‚Äì Atlas Wewnƒôtrzny", status: "published" },
      { title: "Kronika Woli", status: "idea" }
    ],
    2: [
      { title: "EterSeeker ‚Äì Ksiƒôga Zakazana (Tom Zero)", status: "writing" },
      { title: "PoleSeeker ‚Äì Topologia Ludzkiego Pola", status: "idea" }
    ],
    3: [
      { title: "Fito-Seeker", status: "draft" },
      { title: "ObfitoSeeker ‚Äì Kod Obfito≈õci", status: "published" }
    ],
    // ... reszta Bram na razie pusta
  };

  let mapData = {
    bramy: ORIGINAL_BRAMY.map(brama => ({
      ...brama,
      x: 0, y: 0,
      books: SAMPLE_BOOKS[brama.id] || []
    })),
    timestamp: Date.now(),
    version: 13.0
  };

  // Canvas
  const canvas = document.getElementById('mapCanvas');
  const ctx = canvas.getContext('2d');
  let scale = 0.8, offsetX = 0, offsetY = 0;
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  // Pozycje w okrƒôgu
  const initPositions = () => {
    const radius = 900;
    mapData.bramy.forEach((brama, i) => {
      const angle = (i / mapData.bramy.length) * Math.PI * 2 - Math.PI / 2;
      brama.x = Math.cos(angle) * radius;
      brama.y = Math.sin(angle) * radius;
    });
  };

  // Status ‚Üí kolor
  const getStatusColor = (status) => {
    const colors = {
      published: '#12C65B',
      ready: '#D9A441',
      writing: '#28D3C6',
      draft: '#FFB14B',
      idea: '#888888'
    };
    return colors[status] || '#888888';
  };

  // Rysowanie
  const renderMap = () => {
    ctx.fillStyle = 'rgba(0,0,0,0.08)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.translate(canvas.width/2 + offsetX, canvas.height/2 + offsetY);
    ctx.scale(scale, scale);

    // Po≈ÇƒÖczenia
    ctx.strokeStyle = 'rgba(40,211,198,0.15)';
    ctx.lineWidth = 1.5 / scale;
    for (let i = 0; i < mapData.bramy.length; i++) {
      for (let j = i+1; j < mapData.bramy.length; j++) {
        const b1 = mapData.bramy[i], b2 = mapData.bramy[j];
        ctx.beginPath();
        ctx.moveTo(b1.x, b1.y);
        ctx.lineTo(b2.x, b2.y);
        ctx.stroke();
      }
    }

    // Bramy i ksiƒôgi
    mapData.bramy.forEach(brama => {
      const pulse = Math.sin(Date.now() / 800 + brama.id) * 0.2 + 1.3;
      const size = 40 * pulse;

      const grad = ctx.createRadialGradient(brama.x, brama.y, 0, brama.x, brama.y, size * 2);
      grad.addColorStop(0, brama.color);
      grad.addColorStop(0.4, brama.color + 'cc');
      grad.addColorStop(1, 'transparent');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(brama.x, brama.y, size * 2, 0, Math.PI * 2);
      ctx.fill();

      // Ksiƒôgi
      brama.books.forEach((book, i) => {
        const angle = (i / brama.books.length) * Math.PI * 2 + Date.now() / 5000;
        const dist = 160 + Math.sin(Date.now() / 1000 + i) * 20;
        const bx = brama.x + Math.cos(angle) * dist;
        const by = brama.y + Math.sin(angle) * dist;

        ctx.fillStyle = getStatusColor(book.status);
        ctx.beginPath();
        ctx.arc(bx, by, 10, 0, Math.PI * 2);
        ctx.fill();
      });
    });

    ctx.restore();
    requestAnimationFrame(renderMap);
  };

  // Klikniƒôcie
  canvas.addEventListener('click', (e) => {
    if (isDragging) return;
    const rect = canvas.getBoundingClientRect();
    const mx = (e.clientX - rect.left - canvas.width/2 - offsetX) / scale;
    const my = (e.clientY - rect.top - canvas.height/2 - offsetY) / scale;

    const clicked = mapData.bramy.find(b => Math.hypot(b.x - mx, b.y - my) < 60);
    if (clicked) {
      document.getElementById('infoTitle').textContent = clicked.name;
      document.getElementById('infoSub').textContent = clicked.sub;
      const list = document.getElementById('booksList');
      list.innerHTML = clicked.books.length ? '' : '<li style="text-align:center; color:#888;">Brak ksiƒÖg (jeszcze)</li>';
      clicked.books.forEach(book => {
        const li = document.createElement('li');
        li.className = 'book-item';
        li.innerHTML = `
          <div class="book-title">${book.title}</div>
          <span class="book-status status-\( {book.status}" style="background: \){getStatusColor(book.status)}">
            ${book.status || 'idea'}
          </span>
        `;
        list.appendChild(li);
      });
      document.getElementById('infoPanel').style.display = 'block';
    }
  });

  document.getElementById('closeInfo').onclick = () => {
    document.getElementById('infoPanel').style.display = 'none';
  };

  document.getElementById('centerMap').onclick = () => {
    scale = 0.8; offsetX = 0; offsetY = 0;
  };

  // Reszta kodu: drag, zoom, sync, saveLocal ‚Äì jak w poprzedniej wersji

  // Start
  initPositions();
  renderMap();
</script>
</body>
</html>
